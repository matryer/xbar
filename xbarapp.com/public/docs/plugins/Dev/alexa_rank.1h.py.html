
<!doctype html>
<html lang='en' style='background: #111;'>
	<head>
		<meta charset='utf-8' />
		<meta name='viewport' content='width=device-width' />
		<meta http-equiv='X-UA-Compatible' content='ie=edge'>
		<title>Alexa rank checker in your macOS menu bar</title>
		<link rel='stylesheet' href='/public/css/xbar.css?cb=08%20Mar%2021%2015%3a22%20GMT'>
		<link rel='preconnect' href='https://fonts.gstatic.com'>
		<link rel='preconnect' href='https://fonts.googleapis.com'>
		<link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@500&display=swap'>
		
	<meta name='description' content='Displays Alexa rank from given websites - install xbar for free to get started.'>
	<meta name='author' content='Luca Cappelletti'>
	<meta name='keywords' content='macos,menubar,xbar,bitbar'>
	<meta itemprop='image' content='http://i.imgur.com/30YjoCF.jpg'>
	<meta itemprop='name' content='Alexa rank checker in your macOS menu bar'>
	<meta itemprop='description' content='Displays Alexa rank from given websites - install xbar for free to get started.'>
	<meta name='twitter:card' content='summary_large_image'>
	<meta name='twitter:title' content='Alexa rank checker in your macOS menu bar'>
	<meta name='twitter:description' content='Displays Alexa rank from given websites - install xbar for free to get started.'>
	<meta name='twitter:image' content='http://i.imgur.com/30YjoCF.jpg'>
	<meta name='twitter:creator' content='matryer'>
	<meta property='og:title' content='Alexa rank checker in your macOS menu bar'>
	<meta property='og:description' content='Displays Alexa rank from given websites - install xbar for free to get started.'>
	<meta property='og:url' content='https://xbarapp.com/plugins/Dev/alexa_rank.1h.py.html'>
	<meta property='og:site_name' content='xbar lets you put anything into your macOS menu bar'>
	<meta property='og:type' content='article'>
	<meta property='og:image' content='http://i.imgur.com/30YjoCF.jpg'>
	<link rel='apple-touch-icon' sizes='180x180' href='http://i.imgur.com/30YjoCF.jpg'>
	<link rel='icon' type='image/png' sizes='32x32' href='http://i.imgur.com/30YjoCF.jpg'>
	<link rel='shortcut icon' href='http://i.imgur.com/30YjoCF.jpg'>
	<meta name='msapplication-TileColor' content='#ffffff'>
	<meta name='msapplication-config' content='/public/browserconfig.xml'>
	<meta name='theme-color' content='#ffffff'>
	<style>
		.code-background {
			background: rgb(255,255,255);
			background: linear-gradient(to right, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
		}
		.plugin-app-link {
			margin-left: -32px;
		}
	</style>

	</head>
	<body>
		<header class='flex flex-col'>
			<div class='container mx-auto'>
				<div class='flex items-center space-x-8 p-8 text-white'>
					<a href='/' class='inline-block py-2 text-2xl flex items-center space-x-2 font-bold'>
						<img alt='xbar logo: a circle with three dots inside it' src='/public/img/xbar-2048.png' style='width:48px;height:48px;' />
						<span>xbar</span>
					</a>
					<div class='flex-grow'></div>
					<div>
						<a 
							target='github'
							href='https://github.com/sponsors/matryer' 
							class='text-white px-4 py-2 whitespace-nowrap'
						><span class='mr-1'>ğŸ’œ</span> Sponsor</a>
					</div>
					<div class='hidden md:block'>
						<a 
							target='github'
							href='/dl' 
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						>Coming soon</a>
					</div>
				</div>
			</div>
		</header>
		<div id='menubar' class='text-white whitespace-nowrap overflow-hidden flex flex-wrap justify-end items-center text-right'>
			
			
				<a 
					
					href='/docs/plugins/AWS.html'
				>
					AWS
				</a>
			
				<a 
					
					href='/docs/plugins/Cryptocurrency.html'
				>
					Cryptocurrency
				</a>
			
				<a 
					 class='rounded selected' 
					href='/docs/plugins/Dev.html'
				>
					Dev
				</a>
			
				<a 
					
					href='/docs/plugins/E-Commerce.html'
				>
					E-Commerce
				</a>
			
				<a 
					
					href='/docs/plugins/Email.html'
				>
					Email
				</a>
			
				<a 
					
					href='/docs/plugins/Environment.html'
				>
					Environment
				</a>
			
				<a 
					
					href='/docs/plugins/Finance.html'
				>
					Finance
				</a>
			
				<a 
					
					href='/docs/plugins/Games.html'
				>
					Games
				</a>
			
				<a 
					
					href='/docs/plugins/IoT.html'
				>
					IoT
				</a>
			
				<a 
					
					href='/docs/plugins/Lifestyle.html'
				>
					Lifestyle
				</a>
			
				<a 
					
					href='/docs/plugins/Music.html'
				>
					Music
				</a>
			
				<a 
					
					href='/docs/plugins/Network.html'
				>
					Network
				</a>
			
				<a 
					
					href='/docs/plugins/Politics.html'
				>
					Politics
				</a>
			
				<a 
					
					href='/docs/plugins/Science.html'
				>
					Science
				</a>
			
				<a 
					
					href='/docs/plugins/Sports.html'
				>
					Sports
				</a>
			
				<a 
					
					href='/docs/plugins/System.html'
				>
					System
				</a>
			
				<a 
					
					href='/docs/plugins/Time.html'
				>
					Time
				</a>
			
				<a 
					
					href='/docs/plugins/Tools.html'
				>
					Tools
				</a>
			
				<a 
					
					href='/docs/plugins/Travel.html'
				>
					Travel
				</a>
			
				<a 
					
					href='/docs/plugins/Weather.html'
				>
					Weather
				</a>
			
				<a 
					
					href='/docs/plugins/Web.html'
				>
					Web
				</a>
			
		</div>
		
	<div class='container mx-auto flex flex-wrap space-x-8 justify-start items-start mt-16'>
		<div class='flex flex-col justify-start'>
			<div class='px-8 py-2 max-w-3xl'>
				<h1 class='fancy-font text-white text-6xl'>Alexa rank checker</h1>
			</div>
			<div class='p-8 text-sm'>
				
					
						
							<div class='flex space-x-4 pb-8'>
								<div class='tiny-photo'>
									<a 
										href='/docs/contributors/LucaCappelletti94.html'
									>
										<img class='rounded shadow primary' src='https://avatars.githubusercontent.com/u/7738570?v=4'>
									</a>
								</div>
								<div>
									<a 
										href='/docs/contributors/LucaCappelletti94.html'
										class='light-background rounded-sm shadow-md px-4 py-2 text-white' 
										style='text-decoration: none;'
									>
										Luca Cappelletti (<code style='color:white;'>@LucaCappelletti94</code> on GitHub)
									</a>
								</div>
							</div>
						
					
				
				
					<p class='my-8 text-white opacity-75 text-lg max-w-lg'>
						Displays Alexa rank from given websites
					</p>
				
				<div class='plugin-app-link hidden md:flex items-end p-8 m-8 mb-16 bg-black bg-opacity-25 rounded-lg shadow max-w-md'>
					<div>
						<a 
							href='xbar://app.xbarapp.com/openPlugin?path=Dev%2falexa_rank.1h.py'
							class='rounded bg-white text-gray-800 hover:text-black px-4 py-2 shadow hover:shadow-lg whitespace-nowrap'
						><span class='mr-1'>ğŸ–¥</span> Open in xbar app</a>
					</div>
					<div class='opacity-50 text-sm text-white ml-3'>Requires <a target='github' href='/dl' class='underline'>xbar app</a></div>
				</div>
				
			</div>
		</div>
		<div 
			class='flex flex-col justify-center mb-16'
		>
			<img 
				class='max-w-md w-full'
				src='http://i.imgur.com/30YjoCF.jpg' 
				alt='Image preview of Alexa rank checker plugin.'
				onerror='this.onerror=null;this.src="/public/img/xbar-2048.png";'
			/>
		</div>
	</div>

	
		<div class='code-background text-white p-8 pb-24'>
			<div class='container mx-auto'>
				<div class='flex flex-wrap py-8 space-x-4 justify-end'>
					<div>
						<h2 class='md:text-2xl text-bold'>
							<code>alexa_rank.1h.py</code>
						</h2>
					</div>
					<div class='flex-grow'></div>
					<div>
						<a class='text-sm text-white hover:text-black hover:bg-white px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/edit/master/Dev/alexa_rank.1h.py'>Edit</a>
					</div>
					<div>
						<a class='text-sm text-gray-700 bg-white hover:bg-gray-100 active:text-black px-4 py-2 rounded' target='github' href='https://github.com/matryer/bitbar-plugins/blob/master/Dev/alexa_rank.1h.py'>Open on GitHub</a>
					</div>
				</div>
				<div>
					<pre class='text-sm whitespace-pre-wrap'><code class='break-all '>#!/usr/bin/python
# coding=utf-8
#
# &lt;bitbar.title&gt;Alexa rank checker&lt;/bitbar.title&gt;
# &lt;bitbar.version&gt;v1.1&lt;/bitbar.version&gt;
# &lt;bitbar.author&gt;Luca Cappelletti&lt;/bitbar.author&gt;
# &lt;bitbar.author.github&gt;LucaCappelletti94&lt;/bitbar.author.github&gt;
# &lt;bitbar.desc&gt;Displays Alexa rank from given websites&lt;/bitbar.desc&gt;
# &lt;bitbar.image&gt;http://i.imgur.com/30YjoCF.jpg&lt;/bitbar.image&gt;
# &lt;bitbar.dependencies&gt;python&lt;/bitbar.dependencies&gt;
#
# by Luca Cappelletti

import urllib
import sys
import xml.etree.ElementTree as ET
import time
import json
import os
from urlparse import urlparse

reload(sys)
sys.setdefaultencoding(&#39;utf8&#39;)


class Alexa:
    api_url = &#34;http://data.alexa.com/data&#34;
    is_online_test_url = &#34;http://google.com&#34;
    cache_file_dir = &#34;/tmp/alexa_rank_cache&#34;
    cache_file_name = &#34;/tmp/alexa_rank_cache/alexa_cache.json&#34;
    popularity_icon = &#34; ğŸŒ &#34;
    black_popularity_icon = &#34; â™¥ &#34;
    delta_icon = &#34; â‡• &#34;
    default_flag_icon = &#34;âš‘&#34;
    flags_icons = {
        &#34;AU&#34;: &#34;ğŸ‡¦ğŸ‡º&#34;,
        &#34;CA&#34;: &#34;ğŸ‡¨ğŸ‡¦&#34;,
        &#34;CH&#34;: &#34;ğŸ‡¨ğŸ‡­&#34;,
        &#34;CN&#34;: &#34;ğŸ‡¨ğŸ‡³&#34;,
        &#34;DE&#34;: &#34;ğŸ‡©ğŸ‡ª&#34;,
        &#34;ES&#34;: &#34;ğŸ‡ªğŸ‡¸&#34;,
        &#34;FR&#34;: &#34;ğŸ‡«ğŸ‡·&#34;,
        &#34;GB&#34;: &#34;ğŸ‡¬ğŸ‡§&#34;,
        &#34;IL&#34;: &#34;ğŸ‡®ğŸ‡±&#34;,
        &#34;IT&#34;: &#34;ğŸ‡®ğŸ‡¹&#34;,
        &#34;JP&#34;: &#34;ğŸ‡¯ğŸ‡µ&#34;,
        &#34;KN&#34;: &#34;ğŸ‡°ğŸ‡³&#34;,
        &#34;KR&#34;: &#34;ğŸ‡°ğŸ‡·&#34;,
        &#34;NO&#34;: &#34;ğŸ‡³ğŸ‡´&#34;,
        &#34;NP&#34;: &#34;ğŸ‡³ğŸ‡µ&#34;,
        &#34;PS&#34;: &#34;ğŸ‡µğŸ‡¸&#34;,
        &#34;QA&#34;: &#34;ğŸ‡¶ğŸ‡¦&#34;,
        &#34;RU&#34;: &#34;ğŸ‡·ğŸ‡º&#34;,
        &#34;SS&#34;: &#34;ğŸ‡¸ğŸ‡¸&#34;,
        &#34;US&#34;: &#34;ğŸ‡ºğŸ‡¸&#34;
    }

    OFFLINE = 0
    UNRETRIEVED_DATA = 1
    INVALID_JSON = 2
    UNEXISTING_FILE = 3
    INVALID_URLS = 4
    UNEXISTING_ERROR_ID = 5

    error_messages = {
        OFFLINE: {
            &#34;en&#34;: &#34;You are offline.&#34;,
            &#34;de&#34;: &#34;Du bist Offline.&#34;,
            &#34;it&#34;: &#34;Sei offline.&#34;
        },
        UNRETRIEVED_DATA: {
            &#34;en&#34;: &#34;Unable to get data for %s.&#34;,
            &#34;it&#34;: &#34;Impossibile recuperare dati per %s.&#34;
        },
        INVALID_JSON: {
            &#34;en&#34;: &#34;The file %s does not contain valid json.&#34;,
            &#34;it&#34;: &#34;Il file %s non contiene json valido.&#34;
        },
        UNEXISTING_FILE: {
            &#34;en&#34;: &#34;The file %s does not exist.&#34;,
            &#34;it&#34;: &#34;Il file %s non esiste.&#34;
        },
        INVALID_URLS: {
            &#34;en&#34;: &#34;No valid urls were provided.&#34;,
            &#34;it&#34;: &#34;Non son stati inseriti url validi.&#34;
        },
        UNEXISTING_ERROR_ID: {
            &#34;en&#34;: &#34;The given error_id %s is not valid&#34;,
            &#34;it&#34;: &#34;L&#39;error_id %s fornito non Ã¨ valido&#34;
        }
    }

    website_url_list = []
    alexa_data = {}
    cli = 10
    cache = True
    max_offline_wait = 10
    user_language = &#34;en&#34;
    default_user_language = &#34;en&#34;
    polling_interval = 60 * 60  # One hour
    show_global = True
    show_top_country = True
    show_delta = False
    use_black_icons = False

    def __init__(self, website_url_list, cache=None, polling_interval=None, show_global=None, show_top_country=None, show_delta=None, use_black_icons=None, max_offline_wait=None, user_language=None):

        if cache != None:
            self.cache = cache

        if polling_interval != None:
            self.polling_interval = polling_interval

        if show_global != None:
            self.show_global = show_global

        if show_top_country != None:
            self.show_top_country = show_top_country

        if show_delta != None:
            self.show_delta = show_delta

        if use_black_icons != None:
            self.use_black_icons = use_black_icons

        if max_offline_wait != None:
            self.max_offline_wait = max_offline_wait

        if user_language != None:
            self.user_language = user_language

        for website_url in website_url_list:
            if self.is_valid_url(website_url):
                self.website_url_list.append(website_url)

        if len(self.website_url_list) == 0:
            print(self.get_error_message(self.INVALID_URLS))
            sys.exit()

        self.update()

    @classmethod
    def from_url(cls, website_url, cache=None, polling_interval=None, show_global=None, show_top_country=None, show_delta=None, use_black_icons=None, max_offline_wait=None, user_language=None):
        return cls([website_url], cache, polling_interval, show_global, show_top_country, show_delta, use_black_icons)

    def get_error_message(self, error_id):
        if error_id in self.error_messages:
            if self.user_language in self.error_messages[error_id]:
                return self.error_messages[error_id][self.user_language]
            return self.error_messages[error_id][self.default_user_language]
        print(self.get_error_message(self.UNEXISTING_ERROR_ID), error_id)
        sys.exit(0)

    def get_data(self, website_url, data):
        return self.alexa_data[website_url][data]

    def extract(self, raw_data, key, attribute):
        return raw_data.find(key).get(attribute)

    def extract_delta(self, raw_data):
        try:
            return int(self.extract(raw_data, &#34;RANK&#34;, &#34;DELTA&#34;))
        except AttributeError:
            return 0

    def extract_rank(self, raw_data):
        try:
            return int(self.extract(raw_data, &#34;REACH&#34;, &#34;RANK&#34;))
        except AttributeError:
            return 0

    def extract_country_rank(self, raw_data):
        try:
            return int(self.extract(raw_data, &#34;COUNTRY&#34;, &#34;RANK&#34;))
        except AttributeError:
            return 0

    def extract_country_code(self, raw_data):
        try:
            return self.extract(raw_data, &#34;COUNTRY&#34;, &#34;CODE&#34;)
        except AttributeError:
            return &#34;&#34;

    def extract_country_name(self, raw_data):
        try:
            return self.extract(raw_data, &#34;COUNTRY&#34;, &#34;NAME&#34;)
        except AttributeError:
            return &#34;&#34;

    def extract_url(self, raw_data):
        try:
            return self.extract(raw_data, &#34;POPULARITY&#34;, &#34;URL&#34;).strip(&#34;/&#34;)
        except AttributeError:
            return &#34;&#34;

    def build_url(self, website_url):
        return self.api_url &#43; &#34;?cli=&#34; &#43; str(self.cli) &#43; &#34;&amp;url=&#34; &#43; website_url

    def read_from_url(self, url):
        try:
            return urllib.urlopen(url).read()
        except IOError:
            return None

    def get_alexa_data(self, website_url):
        request_url = self.build_url(website_url)
        data_xml = self.read_from_url(request_url)
        if data_xml == None:
            print(self.get_error_message(self.UNRETRIEVED_DATA), self.clean_url(website_url))
            sys.exit()
        return ET.ElementTree(ET.fromstring(data_xml)).getroot().find(&#34;SD&#34;)

    def update_url_data(self, website_url):
        raw_data = self.get_alexa_data(website_url)
        self.alexa_data[website_url] = {
            &#34;delta&#34;: self.extract_delta(raw_data),
            &#34;global_rank&#34;: self.extract_rank(raw_data),
            &#34;top_country_rank&#34;: self.extract_country_rank(raw_data),
            &#34;top_country_code&#34;: self.extract_country_code(raw_data),
            &#34;top_country_name&#34;: self.extract_country_name(raw_data),
            &#34;url&#34;: self.extract_url(raw_data),
            &#34;last_update&#34;: time.time()
        }

    def save_data_to_cache(self):
        if not os.path.exists(self.cache_file_dir):
            os.makedirs(self.cache_file_dir)
        with open(self.cache_file_name, &#39;w&#39;) as outfile:
            json.dump(self.alexa_data, outfile)

    def load_data_from_cache(self):
        if os.path.exists(self.cache_file_name):
            with open(self.cache_file_name, &#39;r&#39;) as outfile:
                try:
                    return json.load(outfile)
                except ValueError:
                    os.remove(self.cache_file_name)
                    pass
        return {}

    def is_valid_url(self, website_url):
        test = urlparse(website_url)
        if test.netloc == &#34;&#34;:
            return False
        return True

    def is_user_online(self):
        if self.read_from_url(self.is_online_test_url) == None:
            return False
        return True

    def is_url_cached(self, website_url):
        if (website_url in self.alexa_data):
            if(self.get_data(website_url, &#34;last_update&#34;) &gt; time.time() - self.polling_interval):
                return True
        return False

    def update(self):
        if self.cache:
            self.alexa_data = self.load_data_from_cache()
        if self.is_user_online():
            for website_url in self.website_url_list:
                if not self.is_url_cached(website_url):
                    self.update_url_data(website_url)
        if(len(self.alexa_data) == 0):
            seconds_waited = 0
            while(not self.is_user_online() and self.max_offline_wait &gt; seconds_waited):
                time.sleep(1)
                seconds_waited = seconds_waited &#43; 1
            if(self.max_offline_wait &gt; seconds_waited):
                self.update()
            else:
                print(self.get_error_message(self.OFFLINE))
                sys.exit()
        if self.cache:
            self.save_data_to_cache()

    def get_global_alexa_rank(self, website_url):
        return self.get_data(website_url, &#34;global_rank&#34;)

    def get_top_country_alexa_rank(self, website_url):
        return self.get_data(website_url, &#34;top_country_rank&#34;)

    def get_alexa_delta(self, website_url):
        return self.get_data(website_url, &#34;delta&#34;)

    def get_top_country_alexa_code(self, website_url):
        return self.get_data(website_url, &#34;top_country_code&#34;)

    def get_popularity_icon(self):
        if self.use_black_icons == False:
            return self.popularity_icon
        return self.black_popularity_icon

    def get_flag_icon(self, code):
        if self.use_black_icons == False and code in self.flags_icons:
            return self.flags_icons[code]
        return self.default_flag_icon &#43; &#34; &#34; &#43; code &#43; &#34;: &#34;

    def clean_url(self, website_url):
        if website_url not in self.alexa_data or self.alexa_data[website_url][&#34;url&#34;] == &#34;&#34;:
            website_url = website_url.replace(&#34;http://&#34;, &#34;&#34;)
            website_url = website_url.replace(&#34;https://&#34;, &#34;&#34;)
            website_url = website_url.replace(&#34;www.&#34;, &#34;&#34;)
            return website_url
        return self.alexa_data[website_url][&#34;url&#34;]

    def build_bitbar(self):
        for website_url in self.website_url_list:
            bitbar = self.clean_url(website_url) &#43; &#34;:&#34;
            if self.show_global:
                bitbar = bitbar &#43; self.get_popularity_icon() &#43; str(self.get_global_alexa_rank(website_url)) &#43; &#34; &#34;
            if self.show_top_country:
                bitbar = bitbar &#43; self.get_flag_icon(self.get_top_country_alexa_code(website_url)) &#43; \
                    str(self.get_top_country_alexa_rank(website_url))
            if self.show_delta:
                bitbar = bitbar &#43; self.delta_icon &#43; str(self.get_alexa_delta(website_url))
            print(bitbar)
            print(&#34;---&#34;)

###################
#  USAGE EXAMPLES #
###################

# With single url
# myAlexa = Alexa.from_url(&#34;https://twitchtimer.com&#34;)

# Full parameters bonanza
#
# cache: put this to true to cache to /tmp/alexa_rank_cache/alexa_cache.json
# polling_interval: seconds of duration of caching file
# show_global: put this to true to show the global rank
# show_top_country: put this to true to show the top country rank
# show_delta: put this to true to show how the website rank has varied in the last period
# use_black_icons: for those who do not like color in their menu bar
# max_offline_wait: how many seconds should be waited brefore triyng again to read data and eventually show an &#34;You are offline&#34; error.
# user_language: the language in which errors and messages should be shown, if available
#
# myAlexa = Alexa([&#34;twitchtimer.com&#34;, &#34;google.com&#34;], cache=True, polling_interval=60*60, show_global=True, show_top_country=True, show_delta=False, use_black_icons=False, max_offline_wait=15, user_language=&#34;en&#34;)

myAlexa = Alexa([&#34;https://twitchtimer.com&#34;], use_black_icons=True, show_top_country=False)
myAlexa.build_bitbar()
</code></pre>
				</div>
			</div>
		</div>
	

		<footer class='container mx-auto text-white text-lg opacity-75 mt-8'>
			<div class='text-center p-16'>
				<p>
					<div>
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar'>GitHub project</a>
						â€¢
						<a target='github' class='underline hover:text-white' href='https://github.com/matryer/xbar#writing-plugins'>Writing plugins guide</a>
					</div>
					<div class='mt-8'>
						Copyright &copy;2021 Mat Ryer + contributors â€¢ <a target='twitter' class='underline hover:text-white' href='https://twitter.com/matryer'>@matryer</a>
					</div>
					<div class='opacity-50 mt-2'>
						Last updated on 08 Mar 21 15:22 GMT
					</div>
				</p>
			</div>
		</footer>
	</body>
</html>
